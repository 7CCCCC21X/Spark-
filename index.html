<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>SPK Airdrop 批量查询</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --blue:#0078d4;--blue-dark:#005fa3;--bg:#f9f9f9;--card:#fff;
  --border:#e5e7eb;--text:#222;--sub:#666
}
html,body{margin:0;padding:0;height:100%}
body{font-family:-apple-system,Segoe UI,PingFang SC,Helvetica,Arial,sans-serif;
     background:var(--bg);color:var(--text);display:flex;flex-direction:column;align-items:center;padding:24px}
h1{margin:0 0 20px;font-size:26px;color:var(--blue)}
textarea{width:100%;max-width:620px;height:140px;resize:vertical;font-size:14px;padding:10px;
         border:1px solid var(--border);border-radius:8px;box-sizing:border-box}
.btn{margin-top:12px;background:var(--blue);color:#fff;padding:10px 26px;border:none;border-radius:8px;
     font-size:15px;cursor:pointer;transition:.18s background}
.btn:hover{background:var(--blue-dark)} .btn:disabled{opacity:.6;cursor:not-allowed}
table{width:100%;max-width:820px;border-collapse:collapse;margin-top:24px;background:var(--card);border-radius:10px;overflow:hidden}
th,td{padding:10px 14px;border-bottom:1px solid var(--border);text-align:left;font-size:14px}
th{background:#f0f4ff;font-weight:600}
tbody tr:last-child td{border-bottom:none}
small{color:var(--sub)}
#progress{margin-top:10px;font-size:14px;color:var(--sub)}
</style>
</head>
<body>
<h1>SPK Airdrop 批量查询</h1>

<textarea id="addrInput" placeholder="一行一个钱包地址(0x…)"></textarea>
<button id="queryBtn" class="btn">批量查询</button>
<div id="progress"></div>

<table style="display:none">
  <thead><tr>
    <th>#</th><th>地址</th><th>可领取/已领取</th><th>原始返回 JSON</th>
  </tr></thead>
  <tbody id="resultBody"></tbody>
</table>

<script>
const input=document.getElementById('addrInput');
const btn=document.getElementById('queryBtn');
const tbody=document.getElementById('resultBody');
const table=tbody.parentElement;
const progress=document.getElementById('progress');

function fmtNum(n){return (+n).toLocaleString(undefined,{maximumFractionDigits:4});}

btn.onclick=async()=>{
  const addrs=[...new Set(input.value.trim().split(/\s+/).filter(a=>/^0x[a-fA-F0-9]{40}$/.test(a)))]
  if(!addrs.length){alert('请先输入有效地址');return;}
  btn.disabled=true;tbody.innerHTML='';table.style.display='none';
  progress.textContent=`正在查询 0 / ${addrs.length} …`;

  let done=0,idx=1;
  for(const addr of addrs){
    try{
      const r=await fetch(`https://spark2-api.blockanalitica.com/api/v1/spk-airdrop/${addr}/`,
                          {headers:{'accept':'application/json'}});
      const j=await r.json();
      // 你可以根据接口返回字段自行调整
      const claimable=j.claimable??j.claimable_amount??j.claim_bal??0;
      const claimed  =j.claimed??j.claimed_amount??j.claimed_bal??0;

      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${idx++}</td>
                    <td><small>${addr}</small></td>
                    <td>${fmtNum(claimable)} / ${fmtNum(claimed)}</td>
                    <td><small>${JSON.stringify(j)}</small></td>`;
      tbody.appendChild(tr);
    }catch(e){
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${idx++}</td><td><small>${addr}</small></td>
                    <td colspan="2" style="color:#e11d48;">查询失败：${e.message}</td>`;
      tbody.appendChild(tr);
    }
    progress.textContent=`正在查询 ${++done} / ${addrs.length} …`;
  }
  progress.textContent='查询完成 ✔️';
  table.style.display='';
  btn.disabled=false;
};
</script>
</body>
</html>
